<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="icon" href="/static/media/favicon-32x32.png" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="&#x1FA78; Do you remember before? &#x1FA78;" />
    <link href="/_before/fonts.css" rel="stylesheet">
    <title>Before</title>
    <link href="{{ assets.css }}" rel="stylesheet">
    {% if eyes_fix %}
    <style>.Main { background-image: none; }</style>
    {% endif %}
    <link href="/_before/nav.css" rel="stylesheet">
</head>

<body>
    {% include "nav.html" %}
    <script>
        const _before_time = parseInt(document.cookie
            .split('; ')
            .find(row => row.startsWith('offset_sec'))
            .split('=')[1]);

        const CurrentDate = Date;

        // cursed glue
        var bind = Function.bind;
        var unbind = bind.bind(bind);

        function instantiate(constructor, args) {
            return new (unbind(constructor, null).apply(null, args));
        }

        // trickery
        Date = function(Date) {
            for (var n of Object.getOwnPropertyNames(Date)) {
                if (n in TrickeryDate) continue;

                let desc = Object.getOwnPropertyDescriptor(Date,n);
                Object.defineProperty(TrickeryDate,n,desc);
            }

            return TrickeryDate;

            function TrickeryDate() {
                if (arguments.length > 0) {
                    return instantiate(CurrentDate,arguments);
                }

                var date = instantiate(CurrentDate,arguments);
                date = instantiate(CurrentDate,[date.getTime() - _before_time * 1000]);
                return date;
            }
        }(Date);

        const TrueSource = EventSource;
    
        EventSource = function(EventSource) {
            for (var n of Object.getOwnPropertyNames(EventSource)) {
                if (n in TrickSource) continue;

                let desc = Object.getOwnPropertyDescriptor(EventSource,n);
                Object.defineProperty(TrickSource,n,desc);
            }

            return TrickSource;

            function TrickSource(url, options) {
                return instantiate(TrueSource, [`${url}?_before_offset_time=${_before_time}`, options]);
            }
        }(EventSource);


        const _before_old_fetch = fetch.bind(window);
        fetch = async function(url, options) {
            if (options === undefined) {
                options = {
                    headers: {
                        "X-Before-Time": _before_time
                    }
                };
            } else {
                if (options['headers'] != undefined) {
                    options['headers']['X-Before-Time'] = _before_time;
                } else {
                    options['headers'] = {
                        "X-Before-Time": _before_time
                    };
                }
            }

            return _before_old_fetch(url, options);
        };

        function _before_set_time() {
            document.getElementById("_before_current").innerText = new Date().toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'long' });
        }

        _before_set_time();

        window.setInterval(_before_set_time, 1000);
    </script>

    <noscript>You need to enable JavaScript to run this app.</noscript>

    <div id="root"></div>
    <script>
        // unknown create-react-app goop
        ! function(e) {
            function t(t) {
                for (var n, i, l = t[0], f = t[1], p = t[2], c = 0, s = []; c < l.length; c++) i = l[c], Object.prototype.hasOwnProperty.call(o, i) && o[i] && s.push(o[i][0]), o[i] = 0;
                for (n in f) Object.prototype.hasOwnProperty.call(f, n) && (e[n] = f[n]);
                for (a && a(t); s.length;) s.shift()();
                return u.push.apply(u, p || []), r()
            }

            function r() {
                for (var e, t = 0; t < u.length; t++) {
                    for (var r = u[t], n = !0, l = 1; l < r.length; l++) {
                        var f = r[l];
                        0 !== o[f] && (n = !1)
                    }
                    n && (u.splice(t--, 1), e = i(i.s = r[0]))
                }
                return e
            }
            var n = {},
                o = {
                    1: 0
                },
                u = [];

            function i(t) {
                if (n[t]) return n[t].exports;
                var r = n[t] = {
                    i: t,
                    l: !1,
                    exports: {}
                };
                return e[t].call(r.exports, r, r.exports, i), r.l = !0, r.exports
            }
            i.m = e, i.c = n, i.d = function(e, t, r) {
                i.o(e, t) || Object.defineProperty(e, t, {
                    enumerable: !0,
                    get: r
                })
            }, i.r = function(e) {
                "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {
                    value: "Module"
                }), Object.defineProperty(e, "__esModule", {
                    value: !0
                })
            }, i.t = function(e, t) {
                if (1 & t && (e = i(e)), 8 & t) return e;
                if (4 & t && "object" == typeof e && e && e.__esModule) return e;
                var r = Object.create(null);
                if (i.r(r), Object.defineProperty(r, "default", {
                        enumerable: !0,
                        value: e
                    }), 2 & t && "string" != typeof e)
                    for (var n in e) i.d(r, n, function(t) {
                        return e[t]
                    }.bind(null, n));
                return r
            }, i.n = function(e) {
                var t = e && e.__esModule ? function() {
                    return e.default
                } : function() {
                    return e
                };
                return i.d(t, "a", t), t
            }, i.o = function(e, t) {
                return Object.prototype.hasOwnProperty.call(e, t)
            }, i.p = "/";
            var l = this.webpackJsonpsite = this.webpackJsonpsite || [],
                f = l.push.bind(l);
            l.push = t, l = l.slice();
            for (var p = 0; p < l.length; p++) t(l[p]);
            var a = f;
            r()
        }([])
    </script>
    <script src="{{ assets.js_2 }}"></script>
    <script src="{{ assets.js_main }}"></script>
    {% match matomo %}
    {% when Some with (data) %}
    <!-- Matomo -->
    <script type="text/javascript">
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
	var u="{{ data.0|safe }}";
	_paq.push(['setTrackerUrl', u+'matomo.php']);
	_paq.push(['setSiteId', '{{ data.1 }}']);
	var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
	g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->
    {% when None %}
    {% endmatch %}
</body>

</html>
